## FundFlow TDD v1.2

### **주요 변경 사항 (Key Changes)**

- **아키텍처 대폭 단순화:** 복잡한 마이크로서비스와 Celery 비동기 처리를 제거하고, **단순한 동기식 웹 애플리케이션**으로 구조를 단순화했습니다.
    
- **API 연동 제거:** NetSuite, Salesforce 연동 기능이 **완전히 제거**되어 직접 파일 업로드만 지원합니다.
    
- **EY 데이터 사전 저장 방식:** 사용자가 EY 데이터를 업로드하는 대신 **시스템에 미리 저장된 데이터를 활용**하는 방식으로 변경되었습니다.
    
- **프로토타입 초점:** SOC 2 보안, 고성능 처리보다는 **빠른 개발과 사용성 검증**에 집중하여 기술 스택을 경량화했습니다.
    

## **Technical Design Document: FundFlow**

**AI-Powered PE Back-Office Automation Platform**

Version: 1.2 (초기 프로토타입 버전)

Date: 2025년 9월 12일

Authors: Lidia 

### **1. 시스템 아키텍처 개요 (System Architecture Overview)**

#### **1.1. 상위 수준 아키텍처 (High-Level Architecture)**

FundFlow v1.2는 PE 펀드의 SALT 계산 워크플로우를 검증하는 **초기 프로토타입**으로, **전통적인 3계층 웹 애플리케이션 구조**를 채택합니다. 복잡한 분산 시스템 대신 단순하고 빠르게 구현 가능한 **모놀리식 아키텍처**를 통해 사용자 피드백을 신속하게 수집하고 검증합니다.

#### **1.2. 기술 스택 (Technology Stack)**

- **Backend Framework:** Python 3.11 + FastAPI (async/await 지원, 자동 API 문서화)

- **Excel Processing:** pandas + openpyxl (기본 기능만)

- **Database:** SQLite (파일 기반, 단순한 개발/프로토타입)

- **Cache:** File System 캐싱 (단순함 우선)

- **Containerization:** Docker + Docker Compose (모든 환경)

- **Frontend:** React + TypeScript (단순한 SPA)

- **인증:** 기본 세션 기반 인증
    

#### **1.3. 설계 원칙 (Design Principles)**

1. **단순함 최우선 (Simplicity First):** 복잡한 패턴보다는 이해하기 쉬운 직관적 구조
    
2. **빠른 개발 (Rapid Development):** MVP를 신속하게 구현하여 사용자 피드백 수집
    
3. **사용성 중심 (User-Centric):** 기술적 완성도보다는 사용자 경험 검증에 집중
    
4. **향후 확장 고려 (Future-Ready):** 단순하되 향후 기능 확장이 용이한 구조 유지
    

### **2. 엑셀 처리 파이프라인 (Excel Processing Pipeline)**

#### **2.1. 단순화된 파이프라인 아키텍처**

프로토타입 단계의 엑셀 처리는 **동기식 단일 스레드 처리**로 구현하여 복잡성을 최소화합니다.

`파일 업로드 (React)` → `즉시 검증 (FastAPI)` → `SALT 계산 (pandas)` → `결과 반환`

#### **2.2. 파일 처리 기술 선정**

단순함과 안정성을 위해 검증된 라이브러리만 사용합니다.

- **읽기:** `pandas.read_excel()` 기본 함수 사용 (최적화보다는 안정성 우선)
    
- **쓰기:** `pandas.to_excel()` 기본 함수로 결과 파일 생성
    
- **처리 규모:** 프로토타입 수준(10MB 이하, 10개 포트폴리오사, 20개 LP)에 최적화
    

#### **2.3. 파일 처리 워크플로우**

1. **업로드 및 검증:** React 프론트엔드에서 단일 엑셀 파일을 업로드하면, FastAPI가 기본적인 파일 형식과 크기를 검증합니다.

2. **즉시 처리:** 복잡한 큐잉 없이 업로드와 동시에 **동기식으로 즉시 처리**합니다.

3. **SALT 계산:** 시스템에 사전 저장된 EY 데이터와 업로드된 포트폴리오 데이터를 매핑하여 계산을 수행합니다.

4. **결과 제공:** 계산 완료 후 즉시 결과를 사용자에게 표시하고 다운로드 링크를 제공합니다.
    

### **3. SALT 계산 엔진 (SALT Calculation Engine)**

#### **3.1. 단순화된 계산 로직**

복잡한 NumPy 벡터화 연산 대신 **기본적인 pandas 연산**을 사용하여 코드 가독성과 유지보수성을 향상시킵니다.

#### **3.2. EY 데이터 관리**

- **데이터 저장:** EY 제공 엑셀 데이터를 SQLite 테이블(`ey_salt_rules`)에 **미리 로드**하여 저장합니다.

- **계산 알고리즘:**

    1. 사용자의 포트폴리오 데이터(회사명, 주별 매출, LP 지분율)를 읽어옵니다.

    2. `ey_salt_rules` 테이블에서 해당 주의 세법 규칙을 조회합니다.

    3. **단순한 for-loop**를 사용하여 각 포트폴리오 회사별, 주별 계산을 순차적으로 수행합니다.

    4. 계산된 결과를 `salt_calculations` 테이블에 저장하고 엑셀로 출력합니다.
        

### **4. 개발 환경 및 배포 (Development & Deployment)**

#### **4.1. Docker 기반 개발 환경**

모든 환경에서 **Docker + Docker Compose**를 사용하여 일관된 개발/배포 환경을 제공합니다.

- **개발 환경:** Docker Compose로 FastAPI, React, SQLite 컨테이너 통합 실행

- **데이터베이스:** SQLite 파일을 컨테이너 볼륨으로 마운트

- **파일 저장:** 로컬 파일시스템 볼륨 (업로드 파일 및 결과 파일)

- **캐싱:** 파일시스템 기반 캐싱 (임시 파일 및 계산 결과)

#### **4.2. 기본적인 보안 설정**

프로토타입 단계의 **필수적인 보안 요구사항**만 충족합니다.

- **데이터 전송:** HTTPS 강제 (프로덕션 환경)

- **파일 검증:** 업로드 파일 형식 및 크기 제한

- **접근 제어:** 기본적인 세션 기반 인증
    

### **5. API 설계 (API Design)**

#### **5.1. RESTful API (간소화)**

프로토타입에 필요한 **최소한의 엔드포인트**만 제공합니다.

- **POST /api/upload:** 포트폴리오 엑셀 파일 업로드 및 즉시 계산 실행
    
- **GET /api/results/{session_id}:** 계산 결과 조회 및 다운로드 URL 제공
    
- **GET /api/template:** 표준 포트폴리오 템플릿 다운로드
    

#### **5.2. 동기식 처리**

복잡한 비동기 처리나 WebSocket 대신 **전통적인 HTTP 요청-응답** 방식을 사용합니다.

### **6. 데이터베이스 설계 (Database Design)**

#### **6.1. 단순화된 SQLite 스키마**

프로토타입에 필요한 **핵심 테이블**만 구성합니다.

- **users:** 사용자 정보 (id, email, company_name, created_at)

- **user_sessions:** 세션 정보 (session_id, user_id, upload_filename, created_at)

- **ey_salt_rules:** 사전 저장된 EY 데이터 (state, tax_rate, apportionment_formula, effective_date)

- **salt_calculations:** 계산 결과 (session_id, portfolio_company, state, lp_name, allocated_amount)
    

#### **6.2. 성능 최적화 (기본 수준)**

- 기본적인 인덱스만 생성 (Primary Key, Foreign Key)
    
- 복잡한 파티셔닝이나 샤딩 없음
    
- 프로토타입 규모에 적합한 단순한 쿼리 구조
    

### **7. 사용자 인터페이스 (User Interface)**

#### **7.1. 단일 페이지 애플리케이션 (SPA)**

React를 사용하여 **직관적이고 단순한 인터페이스**를 구현합니다.

- **대시보드:** 업로드 버튼과 이전 계산 결과 목록
    
- **업로드 페이지:** 드래그 앤 드롭 파일 업로드 및 실시간 진행 표시
    
- **결과 페이지:** 계산 결과 테이블 및 다운로드 버튼
    

#### **7.2. UX 설계 (단순함 우선)**

- **최소 클릭:** 업로드부터 결과 확인까지 3번의 클릭으로 완료
    
- **명확한 상태 표시:** 업로드, 계산, 완료 상태를 시각적으로 명확하게 표시
    
- **즉각적 피드백:** 모든 사용자 액션에 대한 즉시 응답 제공
    

### **8. 성능 및 확장성 (Performance & Scalability)**

#### **8.1. 프로토타입 성능 목표**

- **처리 시간:** 10MB 엑셀 파일 30분 이내 처리
    
- **동시 사용자:** 3-5명 동시 사용 지원
    
- **응답 시간:** 웹 페이지 로딩 5초 이내
    

#### **8.2. 제한적 확장성**

현재 구조는 프로토타입 검증 목적으로, **대규모 확장은 v1.3에서 재설계** 예정입니다.

### **9. 보안 프레임워크 (Security Framework)**

#### **9.1. 기본적인 보안 조치**

완전한 SOC 2 준수 대신 **필수적인 보안 요구사항**만 충족합니다.

- **데이터 전송:** HTTPS 강제
    
- **파일 검증:** 업로드 파일 형식 및 크기 제한
    
- **세션 관리:** Redis 기반 기본 세션 보안
    
- **접근 로그:** 기본적인 사용자 활동 로깅
    

### **10. 모니터링 및 관측 가능성 (Monitoring & Observability)**

#### **10.1. 기본적인 모니터링**

- **로깅:** 파일 기반 로깅 (JSON 형식)

- **메트릭:** Docker 컨테이너 기본 메트릭

- **알림:** 기본적인 로그 모니터링
    

### **11. 배포 및 DevOps (Deployment & DevOps)**

#### **11.1. 단순한 배포 프로세스**

- **개발 환경:** Docker Compose를 사용한 로컬 개발
    
- **스테이징:** 단일 EC2 인스턴스에 수동 배포
    
- **프로덕션:** 수동 배포 및 기본 헬스체크
    

#### **11.2. CI/CD (최소한 수준)**

- **GitHub Actions**를 사용한 기본적인 테스트 및 Docker 이미지 빌드

- **Docker Compose**를 통한 간단한 배포 프로세스
    

### **12. 테스트 전략 (Testing Strategy)**

#### **12.1. 핵심 기능 테스트**

- **단위 테스트:** SALT 계산 로직에 대한 기본적인 테스트
    
- **통합 테스트:** 파일 업로드 → 계산 → 결과 생성 전체 플로우 테스트
    
- **사용자 테스트:** 실제 테스트 파트너와 함께하는 사용성 검증
    

#### **12.2. 제한적 테스트 범위**

- 성능 테스트, 보안 테스트는 **v1.3에서 본격 실시**
    
- 현재는 **기능 동작 검증과 사용성 확인**에 집중
    

### **13. 리스크 및 제한사항 (Risks & Limitations)**

#### **13.1. 기술적 제한사항**

- **확장성:** 대용량 데이터나 다수 동시 사용자 처리 불가
    
- **성능:** 복잡한 최적화 없이 기본적인 성능만 제공
    
- **보안:** 엔터프라이즈급 보안 기능 미포함
    

#### **13.2. 프로토타입 리스크**

- **기술 부채:** 빠른 개발을 위한 단순화로 인한 향후 리팩토링 필요
    
- **사용자 기대치:** 완전한 기능을 기대하는 사용자와의 기대치 차이
    
- **데이터 의존성:** EY 데이터의 정확성과 업데이트에 대한 높은 의존도
    

### **14. 향후 개발 계획 (Future Development Plan)**

#### **14.1. v1.3 전환 계획**

프로토타입 피드백을 바탕으로 한 **본격적인 제품 개발**:

- 마이크로서비스 아키텍처로 전환
    
- API 연동 기능 추가 (NetSuite, Salesforce)
    
- SOC 2 보안 준수 및 성능 최적화
    
- 고급 대시보드 및 분석 기능 구현
    

#### **14.2. 성공 지표 기반 의사결정**

- 테스트 파트너 피드백 4.0/5.0 이상 시 v1.3 개발 진행
    
- 사용성 검증 완료 후 본격적인 시장 진출 전략 수립